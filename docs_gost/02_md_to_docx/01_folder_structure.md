# Сборка docx из markdown

Все подготовлено, теперь можно писать текст и собирать красивую документацию. Сначала рассмотрим возможную структуру папок, потом несколько примеров, как что делать в gostdown и, наконец, как все собрать и обработать.

## Структура файлов и папок

Структура папок по большому счету не имеет большого значения, однако нужно принимать во внимание особенности скрипта gostdown:

- пути к файлам в .bat должны быть указаны относительно ps1/bat скрипта;
- пути к изображениям также должны быть указаны относительно скрипта, пути относительно самого файла .md скрипт не понимает.

Все .md файлы лежат в директории `/docs` или `/docs_gost`. В `/docs` на каждый раздел документа. Когда я точно знаю, что веб-документация не нужна, я не создаю папку `docs`, она нужна только для работы mkdocs. 

В корне проекта лежат:

- `build.ps1`, `linebreaks.lua` -- сам скрипт и вспомогательный файл;
- `build-docs.bat` -- это командный файл. Если вам нужно добавить еще один файл md в сборку, вам нужно его отредактировать (да, там длинный список, внимательно!);
- `sources.bib` -- здесь перечислены источники (литература), а файл `gost-r-7-0-5-2008-numeric-iaa.csl` -- отвечает за правильное отображение списка литературы. Он просто должен лежать тут;
- `template-report.docx` -- это шаблон. Если вам нужно отредактировать титул, надписи (например рамки вставить), добавить список исполнителей -- все это делаем здесь;
- папка `_img` -- у gostdown есть недостаток -- он плохо обрабатывает относительные пути от файлов. Поэтому, все картинки должны размещаться по пути, расположенному от файла `build-docs.bat`. 

Пример структуры папок одного из моих отчетов:

```text
.
├── docs
├─── docs\01_recognition
├─── docs\03_geoposition
├─── docs\04_behaviour
├─── docs\05_spam
├─── docs\06_growth_trends
├─── docs\07_hardware
├─── docs\08_alg
├─── docs\appendix
├── docs\report-beginning.md
├── docs\report-end.md
├── _img
├── build-docs.bat
├── build.ps1
├── gost-r-7-0-5-2008-numeric-iaa.csl
├── linebreaks.lua
├── photon-docs-nir22.code-workspace
├── report.docx
├── sources.bib
└── template-report.docx
```

Пример структуры с файлами (первые две директории):

```text
.
└── docs
    ├── docs\01_recognition
    │   ├── docs\01_recognition\img
    │   ├── docs\01_recognition\01_rcg_intro.md
    │   ├── docs\01_recognition\02_rcg_objects.md
    │   ├── docs\01_recognition\03_impl.md
    │   └── docs\01_recognition\rcg_summary.md
    └── docs\03_geoposition
        ├── docs\03_geoposition\img
        ├── docs\03_geoposition\01_geo_intro.md
        ├── docs\03_geoposition\02_geo_ner.md
        ├── docs\03_geoposition\03_geo_image.md
        ├── docs\03_geoposition\04_geo_impl.md
        └── docs\03_geoposition\05_geo_osm.md
```

Кстати, так как мне часто приходится создавать типовые документы с типовой структурой, то создание такой структуры директорий также можно автоматизировать. Для примера в репозитории в папке `/scripts_and_macros` лежит скрипт `md_creator.py` и конфигурационный файл к нему -- `md_creator_config.json`. В конфигурационном файле указывается структура директорий, типовое содержимое разделов и количество повторений для файлов. Например, в разделе (`folders`, часто -- раздел ТЗ), есть несколько файлов (`top_files`, подпункты ТЗ), и каждый файл создается с нужным количеством префиксов. Получается структура вида:

```text
- Раздел (/razdel)
-- Подраздел (/podrazdel)
----0100_punkt_tz.md
----0101_device1.md
----0102_device2.md
... и т.д.
```

Запустить скрипт можно командой: `python .\md_creator.py`. По умолчанию будет создана директорий из конфига `md_creator_config.json` с родительской папкой `docs_gost`. Чтобы указать свои параметры, запустить скрипт командой `python .\md_creator.py -cf "md_creator_config.json" -fn "docs"`.
